<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Car Deals - All Cars</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; margin: 0; padding: 0; }
    .container { max-width: 1100px; margin: 40px auto; background: #181818; border-radius: 10px; box-shadow: 0 2px 16px #0008; padding: 28px; }
    h1 { text-align: center; margin-bottom: 18px; }
    .sort-bar { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 18px; }
    .sort-label { margin-right: 8px; font-size: 1em; color: #ccc; }
    .sort-select { background: #222; color: #fff; border: 1px solid #444; border-radius: 4px; padding: 4px 10px; font-size: 1em; }
    .car-list { display: flex; flex-wrap: wrap; gap: 24px; justify-content: center; }
    .car-card {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      width: 270px;
      padding: 16px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.2s, border 0.2s, background 0.2s;
      color: #fff;
    }
    .car-card.removed {
      border: 2px solid #e53935;
      background: #2a1818;
      opacity: 0.7;
    }
    .car-card.removed .car-title,
    .car-card.removed .car-info,
    .car-card.removed .car-status {
      color: #ffbdbd;
    }
    .car-img { width: 240px; height: 160px; object-fit: cover; border-radius: 6px; margin-bottom: 12px; background: #333; }
    .car-title {
      font-size: 1.1em;
      font-weight: bold;
      margin-bottom: 6px;
      text-align: center;
      color: #fff;
      word-break: break-word;
      white-space: pre-line;
      overflow-wrap: anywhere;
    }
    .car-info { font-size: 0.97em; color: #eee; margin-bottom: 8px; text-align: center; }
    .car-link { color: #4fc3f7; text-decoration: none; font-size: 0.97em; }
    .car-link:hover { text-decoration: underline; }
    .car-status { font-size: 0.9em; color: #aaa; margin-top: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>All Cars in Database</h1>
    <div class="sort-bar">
      <label class="sort-label" for="sort-by">Sort by:</label>
      <select class="sort-select" id="sort-by">
        <option value="price">Price</option>
        <option value="year">Year</option>
        <option value="kilometers">Kilometers</option>
      </select>
    </div>
    <div class="car-list" id="car-list"></div>
  </div>
  <script>
    let allCars = [];
    let currentSort = 'price';
    const list = document.getElementById('car-list');
    const sortSelect = document.getElementById('sort-by');

    function renderCars(cars) {
      list.innerHTML = '';
      if (!cars.length) {
        list.innerHTML = '<p>No cars found in the database.</p>';
        return;
      }
      cars.forEach(car => {
        const card = document.createElement('div');
        card.className = 'car-card' + (car.status === 'removed' ? ' removed' : '');
        const img = document.createElement('img');
        img.className = 'car-img';
        img.src = (car.image_urls && car.image_urls.length) ? car.image_urls[0] : '';
        img.alt = (car.brand || '') + ' ' + (car.model || '');
        card.appendChild(img);
        const title = document.createElement('div');
        title.className = 'car-title';
        // Split long titles into multiple lines (max 30 chars per line)
        let fullTitle = `${car.brand || ''} ${car.model || ''} ${car.year || ''}`.trim();
        let splitTitle = fullTitle.match(/.{1,30}(\s|$)/g)?.join('\n') || fullTitle;
        title.textContent = splitTitle;
        card.appendChild(title);
        const info = document.createElement('div');
        info.className = 'car-info';
        info.innerHTML =
          (car.price ? `<b>Price:</b> ${car.price} ${car.currency || ''}<br>` : '') +
          (car.kilometers ? `<b>KM:</b> ${car.kilometers}<br>` : '') +
          (car.engine_type ? `<b>Engine:</b> ${car.engine_type}<br>` : '') +
          (car.gearbox_type ? `<b>Gearbox:</b> ${car.gearbox_type}<br>` : '') +
          (car.location ? `<b>Location:</b> ${car.location}<br>` : '') +
          (car.created_date ? `<b>Created:</b> ${car.created_date.split(' ')[0]}<br>` : '') +
          (car.removed_date ? `<b>Removed:</b> ${car.removed_date}<br>` : '');
        card.appendChild(info);
        if (car.listing_url) {
          const link = document.createElement('a');
          link.className = 'car-link';
          link.href = car.listing_url;
          link.target = '_blank';
          link.textContent = 'View Listing';
          card.appendChild(link);
        }
        if (car.status) {
          const status = document.createElement('div');
          status.className = 'car-status';
          status.textContent = `Status: ${car.status}`;
          card.appendChild(status);
        }
        list.appendChild(card);
      });
    }

    function sortCars(cars, by) {
      return cars.slice().sort((a, b) => {
        let va = a[by] ?? Infinity;
        let vb = b[by] ?? Infinity;
        if (typeof va === 'string') va = parseInt(va.replace(/\D/g, '')) || Infinity;
        if (typeof vb === 'string') vb = parseInt(vb.replace(/\D/g, '')) || Infinity;
        return va - vb;
      });
    }

    fetch('cars.json')
      .then(r => r.json())
      .then(data => {
        allCars = data.cars || [];
        renderCars(sortCars(allCars, currentSort));
      });

    sortSelect.addEventListener('change', function() {
      currentSort = sortSelect.value;
      renderCars(sortCars(allCars, currentSort));
    });
  </script>
</body>
</html>
